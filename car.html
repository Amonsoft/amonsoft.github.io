<!Doctype html>

<html>
<head>
<script src="canvasx.js"></script>   
    <script src="scripts/jquery-2.1.4.min.js"></script>
</head>

<body> 
<button id="canvasbtn">Click</button> 
    <canvas id="pump-discharge" width="100" height="100"></canvas>
</body>    
    

<script>
(function(){
    var c = document.getElementById("pump-discharge");
    var ctx = c.getContext("2d");
    
    var mouseIsDown = false;
    
    var that = this;
    c.addEventListener("mousedown", function(e){
        mouseIsDown = true;
    });
    
    document.getElementsByTagName("body")[0].addEventListener("mouseup", function(e){
        mouseIsDown = false;  
    })
    
    var speed = 0; // Our needle speed
    var centerX = c.width / 2; // Center x of the meter
    var centerY = c.height / 2; // Center y of the meter
    var largeHashCount = 16;  // The spacing of large hashes, 16 per 360 degrees
    var smallHashCount = 80;  // The spacing of small hashes, 80 per 360 degrees
    var outterRadius = 48;    // How far from the center both large and small hashes will start
    var largeHashRadius = 40; // How far from the center large hashes will end
    var smallHashRadius = 45; // How far from the center small hashes will end
            
    // Get the outter points of our large hash lines
    var largeHashesOut = getNPointsOnCircle( centerX, centerY, outterRadius, largeHashCount );
    // Get the inner pints ouf our large hash li
    var largeHashesIn = getNPointsOnCircle( centerX, centerY, largeHashRadius, largeHashCount );
    // The hashes start on the right side of the circle
    // and we need to strip off the bottom 3, so remove 3,4,5
    largeHashesOut.splice(3, 3);
    largeHashesIn.splice(3, 3);
    
    // Get the outter points of our small hashes
    var smallHashesOut = getNPointsOnCircle( centerX, centerY, outterRadius, smallHashCount );
    // Get the inner points out of our small hashes
    var smallHashesIn = getNPointsOnCircle( centerX, centerY, smallHashRadius, smallHashCount);   
    // The hashes start on the right side of the circle
    // and we need to strip off the bottom 20, so remove 10,11,12,13....
    smallHashesOut.splice(10, 20);
    smallHashesIn.splice(10, 20);  
  
    // Get the outter points of our needle, use 160 steps instead of a full 360
    var needleHashes = getNPointsOnCircle( centerX, centerY, outterRadius - 5, 160);
    // The needle points start on the right side of the circle,
    // so shift the array so that they start on the bottom left where our first hash is
    needleHashes.push.apply( needleHashes, needleHashes.splice( 0, 60 ) );
    // Remove the last 40 points so they needle stops at hte last hash
    needleHashes.splice(-40);
    
    function drawMeter() {
        // Outside border
        ctx.strokeStyle = "#FF00000";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc( centerX, centerY, c.width / 2 - 1, Math.PI * .75, Math.PI * 2.25, false );
        ctx.closePath();
        ctx.stroke();        
        
        // Small Hashes
        ctx.strokeStyle = "#696969";
        ctx.lineWidth = 1;
        for( var i = 0; i < smallHashesOut.length; i++ ) {
            ctx.beginPath();
            ctx.moveTo( smallHashesOut[i].x, smallHashesOut[i].y );
            ctx.lineTo( smallHashesIn[i].x, smallHashesIn[i].y );
            ctx.closePath();
            ctx.stroke();
        }
        
        // Large Hashes
        ctx.strokeStyle = "#000000";
        ctx.lineWidth = 2;
        for( var i = 0; i < largeHashesOut.length; i++ ) {
            ctx.beginPath();
            ctx.moveTo( largeHashesOut[i].x, largeHashesOut[i].y );
            ctx.lineTo( largeHashesIn[i].x, largeHashesIn[i].y );
            ctx.closePath();
            ctx.stroke();
        }      
    }
    
    function drawNeedle() {        
        // Needle Base
        ctx.fillStyle = "#000000"
        ctx.beginPath();
        ctx.arc( centerX, centerY, 5, 0, Math.PI * 2, false );
        ctx.closePath();
        ctx.fill();
        
        // Needle
        ctx.strokeStyle = "#FF0000";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo( centerX, centerY );
        ctx.lineTo( needleHashes[speed].x, needleHashes[speed].y );
        ctx.closePath();
        ctx.stroke();
    }
    
    function getNPointsOnCircle( x, y, radius, n) {
        // Found out the spacing of each point based on n points in 360 degrees
        var hashSpacing = Math.PI * 2 / n;
        var points = [];
        
        // For each point of n, find it's position based on the given radius and starting x, y
        for( var i = 0; i < n; i++ ){
            var a = hashSpacing * i;
            points.push( { x: x + Math.cos( a ) * radius, y: y + Math.sin( a ) * radius } );
        } 
        
        return points;
    }    
   
    
    function run(){
        if(mouseIsDown){
            if(speed < needleHashes.length - 1) speed += 1;   
        }
        else {
            if(speed > 0) speed -= 1;   
        }
        
        ctx.clearRect( 0, 0, c.width, c.height );
        drawMeter();
        drawNeedle();
        window.setTimeout( run, 1000 / 60 );
    }
    
    run();
}());

</script>
</html>